<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<meta http-equiv="content-type" content="text/html; charset=UTF8">
<head>
<title>Test Page</title>
<script type="text/javascript" src="../libs/knockout-2.2.1.js"></script>
<script type="text/javascript" src="../libs/d3.v3.min.js"></script>
<script type="text/javascript" src="../tools.js"></script>
<script type="text/javascript" src="../charting.js"></script>
<script type="text/javascript" src="../kotools.js"></script>
<script>

var testOptions = { legend: true, width:300, height:150}

</script>
</head>
<body>
	<h2>Last Week Sales:</h2>
	<div id="carsChart" data-bind="piechart: cars, transformation:transformToChart, chartOptions:testOptions">

	</div>
	
	<h2>Monthly Sales</h2>
	<div id="monthlySales" data-bind="stackedbarchart: carSales, xcoord:'year'">

	</div>
	
	<h2>Life Expenses</h2>
	<div id="lifeExpenses" data-bind="stackedbarchart: lifeExpenses, xcoord:'month'">

	</div>
		
</body>

<script>
var carSales = [ 
	{
		year:'january',
		peugot: '100',
		audit: '200',
		bmw:'300'
	},
	{
		year:'february',
		peugot: '50',
		audit: '110',
		bmw:'80'
	},
	{
		year:'marz',
		peugot: '120',
		audit: '230',
		bmw:'115'
	}
]

var lastWeek = [
	{ 
		name: "peugot",
		sales: [100,200,300]
	},
	{ 
		name: "audi",
		sales: [200,300,100]
	},
	{ 
		name: "bmw",
		sales: [200,100,150]
	},
]

var lifeExpenses = [
	{
		month: 'january',
		rent: -500,
		salary : 2200,
		parties : -300
	},
	{
		month: 'february',
		rent: -1000,
		salary : 1500,
		parties : -400
	},
	{
		month: 'marz',
		rent: -800,
		salary : 2500,
		parties : -800
	}	
]

function CarViewModel(data) {
	self = this;
	self.sales = ko.observableArray([]);
	self.name = ko.observable();
	
	self.totalSales = ko.computed(function(x) {
		return sum(self.sales());
	},self);
	
	if(data!=null){
		self.sales(data.sales);
		self.name(data.name);
	}
}

function TestViewModels (data, lastWeek, expenses){
	self.carSales = ko.observableArray([]);
	self.cars = ko.observableArray([]);
	self.lifeExpenses = ko.observableArray([]);
	
	self.carSales(data);
	self.lifeExpenses(expenses);
	self.cars(lastWeek.map(function(x) { return new CarViewModel(x);}));
}

function transformToChart(car){
	return { x: car.name(), y: car.totalSales()};
}

var vm = new TestViewModels(carSales, lastWeek, lifeExpenses);

ko.applyBindings(vm);

</script>

</html>